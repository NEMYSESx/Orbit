[FILTER]
    Name record_modifier
    Match control
    Record control_signal true
    Record processed_at ${time}

[FILTER]
    Name exec
    Match control
    Command /fluent-bit/scripts/process_control.sh
    Parser json

[FILTER]
    Name grep
    Match logs.*
    Exclude control_disabled true

[FILTER]
    Name record_modifier
    Match logs.*
    Record collector fluent-bit
    Record control_enabled true

[FILTER]
    Name modify
    Match logs.*
    Rename timestamp original_timestamp

[FILTER]
    Name nest
    Match logs.*
    Operation lift
    Nested_under details
    Add_prefix detail_